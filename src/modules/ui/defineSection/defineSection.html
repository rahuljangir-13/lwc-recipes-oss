<template>
    <div class="define-section">
        <div class="define-header-row">
            <span class="define-heading">Define</span>
            <button class="define-edit-btn" title="Edit">
                <svg
                    class="slds-icon slds-icon_small"
                    aria-hidden="true"
                    style="width: 22px; height: 22px"
                >
                    <use
                        xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#edit"
                    ></use>
                </svg>
            </button>
        </div>
        <!-- General Information Accordion -->
        <div class="slds-card slds-m-bottom_medium info-card">
            <div
                class="slds-card__header info-header-flex accordion-header"
                onclick={toggleGeneralInfo}
            >
                <span class={generalInfoArrowClass}>▶</span>
                <span class="slds-text-heading_medium info-section-title"
                    >General Information</span
                >
                <span class="slds-badge slds-badge_success info-badge">
                    <template if:true={statusInfo.hasImage}>
                        <img
                            src={statusInfo.imageUrl}
                            alt={statusInfo.altText}
                            class="status-image"
                            onerror={handleImageError}
                            onload={handleImageLoad}
                        />
                    </template>
                    <template if:false={statusInfo.hasImage}>
                        <span class="status-text">{statusInfo.text}</span>
                    </template>
                </span>
            </div>
            <template if:true={isGeneralInfoOpen}>
                <hr class="section-divider" />
                <div
                    class="slds-card__body slds-card__body_inner info-section-body accordion-body"
                >
                    <div class="info-grid-2col">
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">Assessment Name</div>
                                <div class="info-value info-bold">
                                    {assessmentData.name}
                                </div>
                            </div>
                            <div>
                                <div class="info-label">Category</div>
                                <div class="info-value">
                                    {assessmentData.category}
                                </div>
                            </div>
                        </div>
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">Checklist Name</div>
                                <div class="info-value">
                                    <a href="#" class="info-link"
                                        >{assessmentData.checklistName}</a
                                    >
                                </div>
                            </div>
                            <div>
                                <div class="info-label">Occurrence</div>
                                <div class="info-value">
                                    {assessmentData.occurrence}
                                </div>
                            </div>
                        </div>
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">Start Date</div>
                                <div class="info-value">
                                    {assessmentData.startDate}
                                </div>
                            </div>
                            <div>
                                <div class="info-label">End Date</div>
                                <div class="info-value">
                                    {assessmentData.endDate}
                                </div>
                            </div>
                        </div>
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">
                                    Associated Customer
                                </div>
                                <div class="info-value">
                                    <a href="#" class="info-link"
                                        >{assessmentData.associatedCustomer}</a
                                    >
                                </div>
                            </div>
                            <div>
                                <div class="info-label">Description</div>
                                <div class="info-value">
                                    {assessmentData.description}
                                </div>
                            </div>
                        </div>
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">Org Component</div>
                                <div class="info-value">
                                    <a href="#" class="info-link"
                                        >Spare Parts Room</a
                                    >
                                </div>
                            </div>
                            <div></div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Assessment Roles Accordion -->
        <div class="slds-card slds-m-bottom_medium info-card">
            <div
                class="slds-card__header info-header-flex accordion-header"
                onclick={toggleRoles}
            >
                <span class={rolesArrowClass}>▶</span>
                <span
                    class="slds-text-heading_medium"
                    style="font-weight: 700; font-size: 1.25rem"
                    >Assessment Roles</span
                >
            </div>
            <template if:true={isRolesOpen}>
                <hr class="section-divider" />
                <div
                    class="slds-card__body slds-card__body_inner info-section-body accordion-body"
                >
                    <div class="assessment-info-box">
                        Assessment Role assigns associated permissions to
                        selected public group for managing suppliers, viewing
                        responses, closing reviews, editing responses and
                        editing reviews by ensuring limited control over key
                        assessment processes.
                    </div>
                    <div class="roles-grid-2col">
                        <div class="roles-row-2col">
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="administrators"
                                >
                                    Administrators
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.administrators}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="administrators"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="administrators"
                                    >
                                        ▼
                                    </span>
                                    <template
                                        if:true={showDropdowns.administrators}
                                    >
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.administrators}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="administrators"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="approvers"
                                >
                                    Approvers
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.approvers}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="approvers"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="approvers"
                                    >
                                        ▼
                                    </span>
                                    <template if:true={showDropdowns.approvers}>
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.approvers}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="approvers"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div class="roles-row-2col">
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="initiators"
                                >
                                    Initiators
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.initiators}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="initiators"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="initiators"
                                    >
                                        ▼
                                    </span>
                                    <template
                                        if:true={showDropdowns.initiators}
                                    >
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.initiators}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="initiators"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="respondents"
                                >
                                    Respondents
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.respondents}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="respondents"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="respondents"
                                    >
                                        ▼
                                    </span>
                                    <template
                                        if:true={showDropdowns.respondents}
                                    >
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.respondents}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="respondents"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div class="roles-row-2col">
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="reviewers"
                                >
                                    Reviewers
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.reviewers}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="reviewers"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="reviewers"
                                    >
                                        ▼
                                    </span>
                                    <template if:true={showDropdowns.reviewers}>
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.reviewers}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="reviewers"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <div
                                    class="info-label"
                                    onclick={handleLabelClick}
                                    data-role="viewers"
                                >
                                    Viewers
                                </div>
                                <div class="role-search-bar">
                                    <input
                                        class="role-search-input"
                                        type="text"
                                        placeholder="Select an Option..."
                                        value={selectedRoles.viewers}
                                        readonly
                                        onclick={handleRoleDropdownToggle}
                                        data-role="viewers"
                                    />
                                    <span
                                        class="role-search-icon"
                                        onclick={handleRoleDropdownToggle}
                                        data-role="viewers"
                                    >
                                        ▼
                                    </span>
                                    <template if:true={showDropdowns.viewers}>
                                        <div class="role-dropdown">
                                            <template
                                                for:each={roleOptions.viewers}
                                                for:item="option"
                                            >
                                                <div
                                                    key={option.id}
                                                    class="role-option"
                                                    onclick={handleRoleSelection}
                                                    data-role="viewers"
                                                    data-label={option.label}
                                                    data-value={option.value}
                                                >
                                                    {option.label}
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Scoring Ranges Accordion -->
        <div class="slds-card slds-m-bottom_medium info-card scoring-card">
            <div
                class="slds-card__header info-header-flex scoring-header accordion-header"
                onclick={toggleScoring}
            >
                <span class={scoringArrowClass}>▶</span>
                <span class="slds-text-heading_medium scoring-title"
                    >Configure Scoring Ranges</span
                >
            </div>

            <template if:true={isScoringOpen}>
                <div
                    class="slds-card__body slds-card__body_inner scoring-section-body accordion-body"
                >
                    <div class="scoring-table">
                        <div class="scoring-table-header">
                            <div class="stage-column">Flag color</div>
                            <div class="from-column">FROM (%)</div>
                            <div class="to-column">TO (%)</div>
                            <div class="actions-column"></div>
                        </div>

                        <!-- Regular row - shown when not editing this record -->
                        <template for:each={scoringRanges} for:item="range">
                            <div
                                key={range.id}
                                class="scoring-table-row"
                                data-id={range.id}
                            >
                                <template if:false={range.isEditing}>
                                    <div class="stage-column">
                                        <span class={range.colorClass}></span>
                                        <!-- <span>{range.stageName}</span> -->
                                    </div>
                                    <div class="from-column">{range.from}</div>
                                    <div class="to-column">{range.to}</div>
                                    <div class="actions-column">
                                        <button
                                            class="action-icon add-icon"
                                            title="Add Row"
                                            data-id={range.id}
                                            onclick={handleAddNewRow}
                                        >
                                            +
                                        </button>
                                        <button
                                            class="action-icon edit-icon"
                                            title="Edit"
                                            data-id={range.id}
                                            onclick={handleEditRange}
                                        >
                                            <svg aria-hidden="true">
                                                <use
                                                    xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#edit"
                                                ></use>
                                            </svg>
                                        </button>
                                        <button
                                            class="action-icon delete-icon"
                                            title="Delete"
                                            data-id={range.id}
                                            onclick={handleDeleteRange}
                                        >
                                            <svg aria-hidden="true">
                                                <use
                                                    xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#delete"
                                                ></use>
                                            </svg>
                                        </button>
                                    </div>
                                </template>

                                <!-- Edit form - shown when editing this record -->
                                <template if:true={range.isEditing}>
                                    <div class="stage-column">
                                        <div class="color-picker-container">
                                            <select
                                                class="color-picker-select"
                                                data-id={range.id}
                                                data-field="color"
                                                onchange={handleColorChange}
                                                value={range.color}
                                            >
                                                <template
                                                    for:each={availableColors}
                                                    for:item="colorOption"
                                                >
                                                    <option
                                                        key={colorOption.value}
                                                        value={colorOption.value}
                                                    >
                                                        {colorOption.label}
                                                    </option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="from-column">
                                        <input
                                            type="text"
                                            class="numeric-input"
                                            placeholder="0"
                                            value={range.from}
                                            data-id={range.id}
                                            data-field="from"
                                            onchange={handleRangeFieldChange}
                                        />
                                    </div>
                                    <div class="to-column">
                                        <input
                                            type="text"
                                            class="numeric-input"
                                            placeholder="Value"
                                            value={range.to}
                                            data-id={range.id}
                                            data-field="to"
                                            onchange={handleRangeFieldChange}
                                        />
                                    </div>
                                    <div class="actions-column">
                                        <button
                                            class="cancel-btn"
                                            data-id={range.id}
                                            onclick={handleCancelEdit}
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            class="save-btn"
                                            data-id={range.id}
                                            onclick={handleSaveRange}
                                        >
                                            Save
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- System Information Accordion -->
        <div class="slds-card slds-m-bottom_medium info-card">
            <div
                class="slds-card__header info-header-flex accordion-header"
                onclick={toggleSystemInfo}
            >
                <span class={systemInfoArrowClass}>▶</span>
                <span
                    class="slds-text-heading_medium"
                    style="font-weight: 700; font-size: 1.25rem"
                    >System Information</span
                >
            </div>
            <template if:true={isSystemInfoOpen}>
                <hr class="section-divider" />
                <div
                    class="slds-card__body slds-card__body_inner info-section-body accordion-body"
                >
                    <div class="info-grid-2col">
                        <div class="info-row-2col">
                            <div>
                                <div class="info-label">Created By</div>
                                <div class="info-value">
                                    <a href="#" class="info-link"
                                        >Red Guard Supplier</a
                                    >, 5/16/2025, 12:39 PM
                                </div>
                            </div>
                            <div>
                                <div class="info-label">Last Modified By</div>
                                <div class="info-value">
                                    <a href="#" class="info-link">Dev Admin</a>,
                                    6/3/2025, 4:18 PM
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Create Recurring Assessments -->
        <div class="slds-form-element slds-m-top_medium">
            <div class="slds-form-element__control">
                <div class="slds-checkbox">
                    <input type="checkbox" name="recurring" id="recurring" />
                    <label class="slds-checkbox__label" for="recurring">
                        <span class="slds-checkbox_faux"></span>
                        <span class="slds-form-element__label"
                            >Create Recurring Assessments?</span
                        >
                    </label>
                </div>
            </div>
        </div>
    </div>
</template>
